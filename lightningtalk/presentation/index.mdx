import { Layout, Image, Appear, Fit, Fill, Heading, Link, Table, TableHeader, TableHeaderItem, TableBody, TableRow, TableItem, Text, S } from 'spectacle';
import { DarkSlide, CodeSlide } from './slides';
import arex from '../assets/arex.jpg';
import julia from '../assets/julia.png';
import cloudRun from '../assets/cloud-run.png';
import dash from '../assets/dash.png';
import fieryDash from '../assets/fiery-dash.png';
import satelliteTelemetry from '../assets/satellite-telemetry.png';

# Juliaã€GCP Cloud Runã§Dash 

<div style={{ marginLeft: "auto", marginRight: "auto" }}>
  <Image style={{ display: "inline-block", height: "20vmin", marginBottom: "2.1em", verticalAlign: "bottom" }} src={julia} />
  <p style={{ display: "inline-block", fontSize: "7vmin", marginBottom: "8.5vmin", verticalAlign: "bottom", marginRight: "1.5vmin" }}>ã€</p>
  <Image style={{ display: "inline-block", verticalAlign: "bottom", marginRight: "3.5vmin" }} src={cloudRun} />
  <p style={{ display: "inline-block", fontSize: "7vmin", marginBottom: "8.5vmin", verticalAlign: "bottom" }}>ã§</p>
  <Image style={{ display: "inline-block", height: "20vmin", marginBottom: "6vmin", verticalAlign: "bottom" }} src={dash} />
</div>

---

# These slides are at Connpass. So you can check them out.
## ã‚¹ãƒ©ã‚¤ãƒ‰ã¯Connpassã«ã‚¢ãƒƒãƒ—ã•ã‚Œã¦ã„ã¾ã™ã€‚ æ˜¯éã¿ã¦ãã ã•ã„ã€‚

---

# Who am I?
## ãŠå‰èª°?

---

# My name is Alex, and I'm from Canada ğŸ‡¨ğŸ‡¦
## ã‚¢ãƒ¬ãƒƒã‚¯ã‚¹ã§ã€ã‚«ãƒŠãƒ€ã‹ã‚‰æ¥ã¾ã—ãŸã€‚

---

<Layout>
  <Fill style={{ margin: "auto" }}>
    <Heading size={3}>My username on Connpass is "globophobe".</Heading>
    <Heading size={4}>Connpassã®ãƒ¦ãƒ¼ã‚¶åã¯ã€Œglobophobeã€ã§ã™ã€‚</Heading>
  </Fill>
  <Fill>
    <Image style={{ borderRadius: "35px", marginLeft: "1em" }} src={arex} />
  </Fill>
</Layout>

---

# I make stuff with Python, Django, Vue.js and React Native. 
## Pythonã‚„Djangoã‚„Vue.jsã‚„React Nativeã§ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã—ã¦ã„ã¾ã™ã€‚

---

# I have been interested in Julia for a long time.
## é•·ã„é–“èˆˆã€Juliaã«èˆˆå‘³ãŒã‚ã‚Šã¾ã™ã€‚

---

# However, I am only just starting.
# ã—ã‹ã—ã€å§‹ã¾ã£ã¦ã°ã‹ã‚Šã®æ„Ÿã˜ã§ã™ã€‚

---

# What is Dash?
## Dash ã¦ä½•ï¼Ÿ

---

# It's a framework for building web dashboards, particulary for data science.
## Webãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’ä½œã‚‹ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã™ã€‚ç‰¹ã«ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹å‘ã‘ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ã™ã€‚

---

# It's made by <Link href="https://plot.ly/">Plotly</Link>, a Canadian IT company, which is famous for plotly.js
## plotly.jsã§æœ‰åã«ãªã£ãŸã€ã‚«ãƒŠãƒ€ã®ITä¼æ¥­Plotlyã«ã‚ˆã£ã¦ä½œæˆã•ã‚Œã¾ã—ãŸã€‚

---

# There is a very nice <Link href="https://dash-gallery.plotly.host/Portal/">gallery of sample apps</Link>.
## ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã®è‰¯ã„æ„Ÿã˜ã®ã‚®ãƒ£ãƒ©ãƒªãƒ¼ãŒã‚ã‚Šã¾ã™ã€‚

---

<Layout>
  <Fill style={{ margin: "auto" }}>
    <Heading size={3}>Example, here is a <Link href="https://dash-gallery.plotly.host/dash-daq-satellite-dashboard/">dashboard of satellite telemetry</Link>.</Heading>
    <Heading size={4}>ãŸã¨ãˆã°ã€ã“ã‚Œã¯è¡›æ˜Ÿé éš”æ¸¬å®šæ³•ã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ã™ã€‚</Heading>
  </Fill>
  <Fill>
    <Link href="https://dash-gallery.plotly.host/dash-daq-satellite-dashboard/"><Image style={{ borderRadius: "35px", marginLeft: "6vmin", height: "70vmin" }} src={satelliteTelemetry} /></Link>
  </Fill>
</Layout>

---

# Both Python and R are officially supported.
## Pythonã¨Rã®ä¸¡æ–¹ãŒå…¬å¼ã«ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã™ã€‚

---

# Basically, you write Python or R and get an web app with Plotly.js and React.js
## ã¤ã¾ã‚Šã«ã€Pythonã¾ãŸã¯Rã‚’æ›¸ã„ã¦ã€Plotly.jsã¨React.jsã§Webã‚¢ãƒ—ãƒªã‚’ä½œæˆã—ã¾ã™ã€‚

---

# No JavaScript need be written.
## JavaScriptã‚’æ›¸ãäº‹ãŒå¿…è¦ãªã„ã§ã™ã€‚

---

# In the case of Python, the web server is Flask.
## Pythonã®å ´åˆã€ã‚¢ãƒ—ãƒªã‚µãƒ¼ãƒãƒ¼ã¯Flaskã§ã™ã€‚

---

# Looking at <Link href="https://github.com/plotly/dashR">dashR</Link>, the Github repository for the R integration...
## Rçµ±åˆã®Githubãƒªãƒã‚¸ãƒˆãƒªã€dashRã‚’è¦‹ã‚‹ã¨...

---

# ...there seems to only be about 3000 lines of R code...
## Rã‚³ãƒ¼ãƒ‰ã¯ç´„3000è¡ŒãŒã—ã‹ãªã„ã§ã™ã€‚

---

# ...mostly related to the "Fiery" server for R.
## ä¸»ã«Rã®ã€ŒFieryã€ã¦ã„ã†ã‚¢ãƒ—ãƒªã‚µãƒ¼ãƒãƒ¼ã«é–¢ã™ã‚‹äº‹ã¿ãŸã„ãªã‚“ã®ã§ã€

---

# Obviously, Julia should also be supported.
# Juliaã‚‚ã‚µãƒãƒ¼ãƒˆã•ã‚Œã‚‹ã¹ãã§ã™ã€‚

---

# Last October, waralex announced [Dashboards.jl](https://github.com/waralex/Dashboards.jl) at [discourse.julialang.org](https://discourse.julialang.org/t/developing-julia-interface-for-plotly-dash/30533/)
## discourse.julialang.orgã§ã€waralexã•ã‚“ã¯æ˜¨å¹´ã®10æœˆã€Dashboards.jlã‚’å…¬é–‹ã®ã‚’ç™ºè¡¨ã—ã¾ã—ãŸã€‚

---

# Dashboards.jl uses HTTP.jl
## Dashboards.jlã¯HTTP.jlã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

---

# Currently, including tests, there are about 2000 lines of Julia code.
## ç¾åœ¨ã€ãƒ†ã‚¹ãƒˆã‚’å«ã‚ã¦ã€ç´„2000è¡Œã®ã‚¸ãƒ¥ãƒªã‚¢ã‚³ãƒ¼ãƒ‰ãŒã‚ã‚Šã¾ã™ã€‚

---

# In the Python universe, there is Dash, <Link href="https://panel.holoviz.org/">Panel</Link> (Bokeh), <Link href="https://www.streamlit.io/">Streamlit</Link>, and <Link href="https://github.com/voila-dashboards/voila">Voila</Link>.
## Pythonã§Webãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’ä½œã‚‹ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã«ã¯ã€Dashã€Panel (Bokeh)ã€Streamlitã€ãã—ã¦VoilaãŒã‚ã‚Šã¾ã™ã€‚ 

---

# What's the difference?
## é•ã„ã¯ï¼Ÿ

<Table style={{ marginTop: "10vmin" }}>
  <TableHeader>
    <TableHeaderItem></TableHeaderItem>
    <TableHeaderItem style={{ width: "20vmin", fontSize: "5vmin" }}>Dash</TableHeaderItem>
    <TableHeaderItem style={{ width: "20vmin", fontSize: "5vmin" }}>Panel</TableHeaderItem>
    <TableHeaderItem style={{ width: "20vmin", fontSize: "5vmin" }}>Streamlit</TableHeaderItem>
    <TableHeaderItem style={{ width: "20vmin", fontSize: "5vmin" }}>Voila</TableHeaderItem>
  </TableHeader>
  <TableBody>
    <TableRow>
      <TableItem style={{ textAlign: "left", fontSize: "5vmin" }}><strong>Julia</strong></TableItem>
      <TableItem>â­•</TableItem>
      <TableItem>âŒ</TableItem>
      <TableItem>âŒ</TableItem>
      <TableItem>âŒ</TableItem>
    </TableRow>
    <TableRow>
      <TableItem style={{ textAlign: "left", fontSize: "5vmin" }}><strong>Serverless</strong></TableItem>
      <TableItem>â­•</TableItem>
      <TableItem>âŒ</TableItem>
      <TableItem>âŒ</TableItem>
      <TableItem>âŒ</TableItem>
    </TableRow>
    <TableRow>
      <TableItem style={{ textAlign: "left", fontSize: "5vmin" }}><strong>Tornado WebSockets</strong></TableItem>
      <TableItem>âŒ</TableItem>
      <TableItem>â­•</TableItem>
      <TableItem>â­•</TableItem>
      <TableItem>â­•</TableItem>
    </TableRow>
  </TableBody>
</Table>

---

# There are interesting points about all of them. 
## ä¸€ã¤ãšã¤ã«ã¤ã„ã¦èˆˆå‘³æ·±ã„ç‚¹ãŒã‚ã‚Šã¾ã™ã€‚

---

# However, Dash is great because it can be used in a serverless environment...
# ã—ã‹ã—ã€Dashã¯ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ç’°å¢ƒã§ä½¿ç”¨ã§ãã‚‹äº‹ã§...

---

# ...and supports multiple programming languages.
## ...è¤‡æ•°ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã‚’ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã™ã€‚

---

# There is a caveat, though.
## ã‘ã‚Œã©ã€æ³¨æ„ç‚¹ãŒã‚ã‚Šã¾ã™ã€‚

---

# Incidentally, it is also why Dash can be used in a serverless environment.
## ã¡ãªã¿ã«ã€Dashã‚’ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ç’°å¢ƒã§ä½¿ç”¨å‡ºæ¥ã‚‹ç†ç”±ã¯ã“ã‚Œã§ã™ã€‚

---

# The state of a Dash app is stored on the client.
# Dashã‚¢ãƒ—ãƒªã®ãƒ‡ãƒ¼ã‚¿ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ã‚ã‚Šã¾ã™ã€‚

---

# This means that "when [the] Dash app UI changes, the state of your app..." 
## ã€ŒDashã‚¢ãƒ—ãƒªã®UIãŒå¤‰æ›´ã•ã‚Œã‚‹ã¨ã€ã‚¢ãƒ—ãƒªã®ãƒ‡ãƒ¼ã‚¿ãŒ...

---

# "...makes a round-trip from client to server to client, and never persists on the server."
## ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã‚µãƒ¼ãƒãƒ¼ã¸ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¸ã®å¾€å¾©ã‚’è¡Œã„ã€ã‚µãƒ¼ãƒãƒ¼ä¸Šã§æ°¸ç¶šåŒ–ã™ã‚‹äº‹ãªã—ã€ã®æ„å‘³ã—ã¾ã™ã€‚

---

<Layout>
	<Fill style={{ margin: "auto" }}>
		<Heading size={4}>Example, multiple R "Fiery" server processes serve multiple clients.</Heading>
		<Heading size={5}>ãŸã¨ãˆã°ã€è¤‡æ•°ã®Rã€ŒFieryã€ã‚µãƒ¼ãƒãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ãŒè¤‡æ•°ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ã‚µãƒ¼ãƒ“ã‚¹ã‚’æä¾›ã—ã¾ã™ã€‚</Heading>
	</Fill>
	<Fill>
		<Image src={fieryDash} style={{ height: "55vmin", marginTop: "12vmin", marginLeft: "8vmin" }} />
	</Fill>
</Layout>


---

# GCP Cloud Run seems great for Julia.
## Cloud Runã¯Juliaã«æœ€é©ã§ã™ã€‚

---

# It's serverless with Knative (Docker containers).
## Knativeï¼ˆDockerã‚³ãƒ³ãƒ†ãƒŠãƒ¼ï¼‰ã§ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ã§ã™ã€‚

---

# The server process listens on environment variable PORT.
## ã‚µãƒ¼ãƒãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ã¯ã€ç’°å¢ƒå¤‰æ•°PORTç•ªã§è€³ã‚’ã™ã¾ã›ã¾ã™ã€‚

---

export default CodeSlide

```julia
import HTTP
using Dashboards
```

```julia
port = get(ENV, "PORT", 8080)
port = port isa String ? parse(Int64, port) : port
```

---

# The following, is from the first <Link href="https://dash.plot.ly/getting-started">Dash tutorial</Link>.
## æ¬¡ã¯ã€Dashã®æœ€åˆã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‹ã‚‰ã®å¤‰æ›ã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã§ã™ã€‚

---

export default CodeSlide

```julia
external_stylesheets = ["https://codepen.io/chriddyp/pen/bWLwgP.css"]
```

```julia
app = Dash("Test app", external_stylesheets=external_stylesheets) do
    html_div() do
        html_h1("Hello Dashboards"),
        html_div("Dashboards: Julia interface for Dash"),
        dcc_graph(
            id = "example-graph",
            figure = (
                data = [
                    (x = [1, 2, 3], y = [4, 1, 2], type = "bar", name = "SF"),
                    (x = [1, 2, 3], y = [2, 4, 5], type = "bar", name = "MontrÃ©al"),
                ],
                layout = (title = "Dash Data Visualization",)
            )
        )
    end
end
```

---

# It seems the server process should bind to "0.0.0.0"
## ã‚µãƒ¼ãƒãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ã¯ã€Œ0.0.0.0ã€ã«ãƒã‚¤ãƒ³ãƒ‰ã™ã‚‹å¿…è¦ãŒã‚ã‚Šãã†ã§ã™ã€‚


---

export default CodeSlide

```julia
handler = make_handler(app, debug = true)
```

```julia
# Bind to all interfaces.
HTTP.serve(handler, "0.0.0.0", port)
```

---

# Let's run it on <Link href="https://julia-gcp-dash-n673kvbdna-an.a.run.app/">GCP Cloud Run</Link>.
## Cloud Runã§å®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

---

# The preceeding, and subsequent Dash tutorials... 
## ã“ã®å‰ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã®ã‚³ãƒ¼ãƒ‰ã€ãã—ã¦å¾Œç¶šã®Dashãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã®ã‚³ãƒ¼ãƒ‰ã¯...

---

# ...have been converted to Julia in waralex's <Link href="https://github.com/waralex/DashboardsExamples">DashboardsExamples</Link>.
## ...waralexã®DashboardsExamplesã®GitHubãƒªãƒã‚¸ãƒˆãƒªã§Juliaã«å¤‰æ›ã•ã‚ŒãŸã€‚

---

# As for WebSockets, and/or real time updates...
## WebSocketsã€ãã—ã¦ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ã«é–¢ã—ã¦...

---

# ...it doesn't seem to be documented in waralex's GitHub repositories...
## ...waralexã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«ã¯æ–‡æ›¸åŒ–ã•ã‚Œã¦ã„ãªã„ã‚ˆã†ã§ã™ãŒ...

---

# ...but Dash supports an interval callback.
## ....Dashã¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚

---

export default CodeSlide

```julia
app = Dash("App Name") do
    html_div() do
        html_div(id = "display-id"),
        dcc_interval(
            id = "interval-id",
            interval = 1000,
            n_intervals = 0
        )
    end
end
```
---

# Basically, poll the server once a second.
## 1ç§’ã”ã¨ã«ã‚µãƒ¼ãƒãƒ¼ã®æ›´æ–°ã‚’ãƒãƒ¼ãƒªãƒ³ã‚°ã—ã¾ã™ã€‚

---

export default CodeSlide

```julia
callback!(app, callid"interval-id.n_intervals => display-id.children") do n_intervals
    return [ html_span(n_intervals) ]
end
```
---

# Example server response:
## ã‚µãƒ¼ãƒãƒ¼å¿œç­”ã®ä¾‹ï¼š

---

export default CodeSlide

```json
{ 
   "response":{ 
      "props":{ 
         "children":[ 
            { 
               "type":"Span",
               "namespace":"dash_html_components",
               "props":{ 
                  "children":0
               }
            }
         ]
      }
   }
}
```
---

# GCP Cloud Run <Link href="https://cloud.google.com/run/docs/issues">does not support inbound WebSockets</Link>.
## GCP Cloud Runã¯ã‚¤ãƒ³ãƒã‚¦ãƒ³ãƒ‰WebSocketã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“ã€‚

---

# However, outbound WebSockets are supported.
## ã—ã‹ã—ã€ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰WebSocketã¯ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã™ã€‚

---

# So, I opened a WebSocket connection from Julia to a Bitcoin exchange.
## ãã“ã§ã€Juliaã‹ã‚‰ãƒ“ãƒƒãƒˆã‚³ã‚¤ãƒ³å–å¼•æ‰€ã¸ã®WebSocketæ¥ç¶šã‚’é–‹ãã¾ã—ãŸã€‚

---

# The result, including loading data from Google BigQuery and FireStore, is a <Link href="https://julia-gcp-bigquery-n673kvbdna-an.a.run.app/">work in progress</Link>.
## ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¯ã€Google BigQueryã¨FireStoreã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã‚’å«ã¿ã€é€²è¡Œä¸­ã®ä½œæ¥­ã§ã™ã€‚

---


# Thatâ€™s all. Thanks for listening.
## ä»¥ä¸Šã§ã™ã€‚ã”æ¸…è´ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚
